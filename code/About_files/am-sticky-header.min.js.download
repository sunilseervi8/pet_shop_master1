define(['jquery','matchMedia','domReady!'],function($,mediaCheck){'use strict';$.widget('mage.amStickyHeader',{options:{classes:{navToggle:'-desktop-navigation-toggle',show:'-show',sticky:'-sticky-header'},headerHeight:0,isDisplayOnScrollDown:false,hideOnScrollDown:true,hideOnScrollDownOffset:null,isAlwaysDisplay:false,isDesktop:false,isDisplayOnScrollUp:false,isStickyHeaderEnabled:false,mediaBreakpoint:'(min-width: 768px)',showDesktopNavToggle:true,selectors:{headerElement:null,navSection:'.sections.nav-sections',pageContentElement:'.page-wrapper',toggleNavSelector:'[data-action="toggle-nav"]'}},lastPageYOffset:window.pageYOffset,_create:function(){if(this.options.isStickyHeaderEnabled){this.pageContentElement=$(this.options.selectors.pageContentElement);this._scrollOffset=0;this.isHeaderShown=false;this.pageContentElementPaddingTop=this.pageContentElement.css('padding-top');this.headerElement=this.options.selectors.headerElement?$(this.options.selectors.headerElement):this.element;this._isVisibleOnScrollDown();this._initResponsive();this._setHeaderHeight();this._initListeners();}
return this;},_initResponsive:function(){var self=this;mediaCheck({media:self.options.mediaBreakpoint,entry:function(){self.isDesktop=true;},exit:function(){self.isDesktop=false;}});},_initListeners:function(){$(window).on('scroll resize',this._handleHeaderOnScroll.bind(this));},_handleHeaderOnScroll:function(){var pageYOffset=window.pageYOffset;if(pageYOffset<=this.headerHeight){this.lastPageYOffset=0;this._destroyStickyMenu();this._setHeaderHeight();}else{this._appendStickyMenu();if(this.options.hideOnScrollDown){this._showHideOnScroll(pageYOffset);}else if(!this.isHeaderShown&&!this.options.hideOnScrollDown){this.showHeader();}
this.lastPageYOffset=pageYOffset;}},_showHideOnScroll:function(currentPageOffset){if(currentPageOffset>this.lastPageYOffset&&this.options.isDisplayOnScrollDown){this._getPositionOffsetToHide(currentPageOffset);currentPageOffset>this._scrollDownOffset?this.hideHeader():this.displayOnScroll();return;}
if(currentPageOffset<this.lastPageYOffset){this.options.isDisplayOnScrollUp?this.displayOnScroll():this.hideHeader();}},_isVisibleOnScrollDown:function(){if(this.options.isAlwaysDisplay){this.options.hideOnScrollDown=false;}},_getPositionOffsetToHide:function(currentPageOffset){if(!this.options.hideOnScrollDownOffset){this._scrollDownOffset=currentPageOffset;}else{this._scrollDownOffset=this._calcOffsetPosition();}},_calcOffsetPosition:function(){var body=document.body,html=document.documentElement,docHeight=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);return(Number.parseInt(this.options.hideOnScrollDownOffset)*docHeight)/ 100;},_setHeaderHeight:function(){this.headerHeight=$(this.headerElement).outerHeight();},_showDesktopMenu:function(){this.headerElement.removeClass(this.options.classes.navToggle);},_hideDesktopMenu:function(){var $html=$('html');this.headerElement.addClass(this.options.classes.navToggle);if($html.hasClass('nav-open')){$html.removeClass('nav-open nav-before-open');}},displayOnScroll:function(){if(!this.isHeaderShown){this.showHeader();}},_destroyStickyMenu:function(){this.headerElement.removeClass(this.options.classes.sticky);this.pageContentElement.css('padding-top',this.pageContentElementPaddingTop);this._showDesktopMenu();this.hideHeader();},_appendStickyMenu:function(){if(!this.headerElement.hasClass(this.options.classes.sticky)){this.pageContentElement.css('padding-top',this.headerHeight);this.headerElement.addClass(this.options.classes.sticky);if(this.options.showDesktopNavToggle&&this.isDesktop){this._hideDesktopMenu();}}},showHeader:function(){this.headerElement.addClass(this.options.classes.show);this.isHeaderShown=true;},hideHeader:function(){this.headerElement.removeClass(this.options.classes.show);this.isHeaderShown=false;this.hideOnScrollDownOffset=null;}});return $.mage.amStickyHeader;});